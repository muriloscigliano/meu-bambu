---
interface Props {
	text: string;
	href?: string;
	type?: 'link' | 'button' | 'submit';
	theme?: 'light' | 'dark' | 'primary';
	class?: string;
	disabled?: boolean;
}

const {
	text,
	href,
	type = href ? 'link' : 'button',
	theme = 'dark',
	class: className = '',
	disabled = false
} = Astro.props as Props;

const isLink = type === 'link' && href;
---

{isLink ? (
	<a
		data-theme={theme}
		data-btn-hover
		href={href}
		class={`btn ${className}`}
		role="link"
	>
		<span class="btn__bg" aria-hidden="true"></span>
		<span class="btn__circle-wrap" aria-hidden="true">
			<span class="btn__circle">
				<span class="btn__circle-inner"></span>
			</span>
		</span>
		<span class="btn__text">{text}</span>
	</a>
) : (
	<button
		data-theme={theme}
		data-btn-hover
		type={type === 'submit' ? 'submit' : 'button'}
		class={`btn ${className}`}
		disabled={disabled}
	>
		<span class="btn__bg" aria-hidden="true"></span>
		<span class="btn__circle-wrap" aria-hidden="true">
			<span class="btn__circle">
				<span class="btn__circle-inner"></span>
			</span>
		</span>
		<span class="btn__text">{text}</span>
	</button>
)}

<style>
.btn {
	cursor: pointer;
	border-radius: calc(var(--btn-height, 3em) * 0.5);
	justify-content: center;
	align-items: center;
	height: 3em;
	padding-left: 1.5em;
	padding-right: 1.5em;
	text-decoration: none;
	display: inline-flex;
	position: relative;
	transition: transform 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.btn:active {
	transform: scale(0.96);
}

.btn:focus-visible {
	outline: 3px solid var(--color-accent);
	outline-offset: 3px;
}

.btn__text {
	color: currentColor;
	white-space: nowrap;
	font-family: var(--font-display);
	font-size: 1em;
	font-weight: 700;
	font-style: italic;
	text-transform: uppercase;
	line-height: 1.2;
	position: relative;
	z-index: 2;
	transition: color 0.7s cubic-bezier(0.625, 0.05, 0, 1);
}

.btn__bg {
	background-color: var(--color-bg-dark);
	border-radius: 1.5em;
	width: 100%;
	height: 100%;
	position: absolute;
	top: 0;
	left: 0;
	z-index: 0;
}

.btn__circle-wrap {
	border-radius: 1.5em;
	width: 100%;
	height: 100%;
	position: absolute;
	top: 0;
	left: 0;
	overflow: hidden;
	z-index: 1;
}

.btn__circle {
	pointer-events: none;
	background-color: var(--color-accent);
	border-radius: 50%;
	width: 100%;
	display: block;
	position: absolute;
	top: 50%;
	left: 50%;
	transition: transform 0.7s cubic-bezier(0.625, 0.05, 0, 1), background-color 0.4s cubic-bezier(0.625, 0.05, 0, 1);
	transform: translate(-50%, -50%) scale(0) rotate(0.001deg);
}

.btn__circle-inner {
	padding-top: 100%;
	display: block;
}

.btn .btn__text {
	transition: color 0.7s cubic-bezier(0.625, 0.05, 0, 1);
}

.btn:hover .btn__circle {
	transform: translate(-50%, -50%) scale(1) rotate(0.001deg);
}

/* Dark theme (default) */
.btn[data-theme="dark"] .btn__bg {
	background-color: var(--color-bg-dark);
}

.btn[data-theme="dark"] .btn__text {
	color: var(--color-text-light);
}

.btn[data-theme="dark"] .btn__circle {
	background-color: var(--color-accent);
}

.btn[data-theme="dark"]:hover .btn__text {
	color: var(--color-bg-dark);
}

/* Light theme */
.btn[data-theme="light"] .btn__bg {
	background-color: var(--color-bg-secondary);
}

.btn[data-theme="light"] .btn__text {
	color: var(--color-text-primary);
}

.btn[data-theme="light"] .btn__circle {
	background-color: var(--color-button-dark);
}

.btn[data-theme="light"]:hover .btn__text {
	color: var(--color-text-light);
}

/* Primary theme */
.btn[data-theme="primary"] .btn__bg {
	background-color: var(--color-accent);
}

.btn[data-theme="primary"] .btn__text {
	color: var(--color-bg-dark);
}

.btn[data-theme="primary"] .btn__circle {
	background-color: var(--color-button-dark);
}

.btn[data-theme="primary"]:hover .btn__text {
	color: var(--color-text-light);
}

/* Button element reset */
button.btn {
	border: none;
	background: none;
	font: inherit;
}

/* Disabled state */
.btn:disabled,
.btn[disabled] {
	opacity: 0.5;
	cursor: not-allowed;
	pointer-events: none;
}
</style>

<script>
function initDirectionalButtonHover() {
  // Button hover animation
  document.querySelectorAll('[data-btn-hover]').forEach(button => {
    button.addEventListener('mouseenter', handleHover);
    button.addEventListener('mouseleave', handleHover);
  });

  function handleHover(event: any) {
    const button = event.currentTarget;
    const buttonRect = button.getBoundingClientRect();

    // Get the button's dimensions and center
    const buttonWidth = buttonRect.width;
    const buttonHeight = buttonRect.height;
    const buttonCenterX = buttonRect.left + buttonWidth / 2;

    // Calculate mouse position
    const mouseX = event.clientX;
    const mouseY = event.clientY;

    // Offset from the top-left corner in percentage
    const offsetXFromLeft = ((mouseX - buttonRect.left) / buttonWidth) * 100;
    const offsetYFromTop = ((mouseY - buttonRect.top) / buttonHeight) * 100;

    // Offset from the center in percentage
    let offsetXFromCenter = ((mouseX - buttonCenterX) / (buttonWidth / 2)) * 50;

    // Convert to absolute values
    offsetXFromCenter = Math.abs(offsetXFromCenter);

    // Update position and size of .btn__circle
    const circle = button.querySelector('.btn__circle');
    if (circle) {
      circle.style.left = `${offsetXFromLeft.toFixed(1)}%`;
      circle.style.top = `${offsetYFromTop.toFixed(1)}%`;
      circle.style.width = `${115 + Number(offsetXFromCenter.toFixed(1)) * 2}%`;
    }
  }
}

// Initialize Directional Button Hover
document.addEventListener('DOMContentLoaded', function() {
  initDirectionalButtonHover();
});
</script>

