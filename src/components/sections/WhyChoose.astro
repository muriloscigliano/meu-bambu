---
import Icon from '../Icon.astro';

interface Props {
	title: string;
	description: string;
	features: Array<{
		title: string;
		description: string;
	}>;
}

const { title, description, features } = Astro.props as Props;
const midPoint = Math.ceil(features.length / 2);
const leftFeatures = features.slice(0, midPoint);
const rightFeatures = features.slice(midPoint);
---

<section class="why-choose" data-section aria-labelledby="why-choose-title">
	<!-- Parallax Background Image -->
	<div class="why-choose__bg-image" data-parallax-bg aria-hidden="true"></div>

	<div class="why-choose__container">
		<header class="why-choose__content">
			<h2 id="why-choose-title" class="why-choose__title" data-split="heading">{title}</h2>
			<p class="why-choose__description" data-animate="fade-in">{description}</p>
		</header>

		<div class="why-choose__features" data-animate="fade-in" role="list" aria-label="Diferenciais do produto">
			<ul class="why-choose__feature-col" data-animate="stagger">
				{leftFeatures.map((feature, index) => (
					<>
						<li class="why-choose__feature" data-stagger-item>
							<Icon name="checkmark" size={36} class="why-choose__feature-icon" aria-hidden="true" />
							<h3 class="why-choose__feature-title">{feature.title}</h3>
							<p class="why-choose__feature-desc">{feature.description}</p>
						</li>
						{index < leftFeatures.length - 1 && <li class="why-choose__feature-divider" aria-hidden="true"></li>}
					</>
				))}
			</ul>

			<div class="why-choose__col-divider" role="separator" aria-hidden="true"></div>

			<ul class="why-choose__feature-col" data-animate="stagger">
				{rightFeatures.map((feature, index) => (
					<>
						<li class="why-choose__feature" data-stagger-item>
							<Icon name="checkmark" size={36} class="why-choose__feature-icon" aria-hidden="true" />
							<h3 class="why-choose__feature-title">{feature.title}</h3>
							<p class="why-choose__feature-desc">{feature.description}</p>
						</li>
						{index < rightFeatures.length - 1 && <li class="why-choose__feature-divider" aria-hidden="true"></li>}
					</>
				))}
			</ul>
		</div>
	</div>
</section>

<script>
	import { gsap, ScrollTrigger } from '../../utils/gsap';
	
	gsap.registerPlugin(ScrollTrigger);
	
	function initParallax() {
		const bgImage = document.querySelector('[data-parallax-bg]');
		
		if (!bgImage) return;
		
		// Smooth parallax effect - moves 10% of scroll distance
		gsap.to(bgImage, {
			yPercent: 15,
			ease: 'none',
			scrollTrigger: {
				trigger: '.why-choose',
				start: 'top bottom',
				end: 'bottom top',
				scrub: 1.5, // Smooth scrubbing (higher = smoother)
			}
		});
	}
	
	// Initialize on load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initParallax);
	} else {
		initParallax();
	}
</script>

<style>
.why-choose {
	position: relative;
	isolation: isolate;
	min-height: var(--section-min-height);
	display: flex;
	align-items: center;
	background: var(--color-bg-darker);
	/* border-top: 1px solid rgba(255, 255, 255, 0.1);
	border-bottom: 1px solid rgba(255, 255, 255, 0.1); */
	padding-block: 90px;
	overflow: hidden;
}

/* Parallax Background Image */
.why-choose__bg-image {
	position: absolute;
	inset: -10% 0; /* Extra height for parallax movement */
	width: 100%;
	height: 120%;
	background-image: url("/images/floresta-bambu.jpg");
	background-size: cover;
	background-position: center;
	background-repeat: no-repeat;
	will-change: transform;
	z-index: 0;
}

.why-choose::before,
.why-choose::after {
	background: rgba(255, 255, 255, 0.1);
}

.why-choose::before {
	content: '';
	position: absolute;
	inset: 0;
	background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3CradialGradient id='bamboo-gradient' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' style='stop-color:%234b4234;stop-opacity:0.1'/%3E%3Cstop offset='100%25' style='stop-color:%2324261d;stop-opacity:0.3'/%3E%3C/radialGradient%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23bamboo-gradient)'/%3E%3C/svg%3E");
	opacity: 0.5;
	pointer-events: none;
}

.why-choose::after {
	content: '';
	position: absolute;
	inset: 0;
	background: linear-gradient(90deg, rgba(0, 0, 0, 0.25) 0%, rgba(0, 0, 0, 0.25) 100%),
				linear-gradient(262.508deg, rgba(75, 66, 52, 0) 16.445%, rgba(36, 36, 29, 0.5) 58.211%);
	pointer-events: none;
}

.why-choose__container { 
	position: relative;
	z-index: 1;
	max-width: var(--container-max); 
	margin-inline: auto;
	width: 100%;
	padding-inline: 2.25rem;
	display: flex;
	gap: 48px;
	align-items: center;
}

.why-choose__content {
	flex: 0 0 604px;
	display: flex;
	flex-direction: column;
	gap: 36px;
}

.why-choose__title { 
	font-family: var(--font-display); 
	font-weight: 900;
	text-transform: uppercase; 
	line-height: 1;
	font-size: 72px;
	color: var(--color-white);
	margin: 0;
}

.why-choose__description {
	font-family: var(--font-sans);
	font-weight: 400;
	font-size: 16px;
	line-height: 1.5;
	color: var(--color-accent);
	margin: 0;
	max-width: 560px;
	letter-spacing: 0.03em;
}

.why-choose__features {
	flex: 1;
	display: flex;
	gap: 1px;
	padding: 48px 24px;
	backdrop-filter: blur(25px);
	background: rgba(36, 38, 29, 0.01);
	border: 1px solid #474637;
    border-radius: 18px;
}

.why-choose__feature-col {
	flex: 1;
	display: flex;
	flex-direction: column;
	gap: 52px;
	list-style: none;
	padding: 0;
	margin: 0;
}

.why-choose__col-divider {
	width: 398px;
	height: 0;
	border-top: 1px solid rgba(255, 255, 255, 0.1);
	align-self: center;
	transform: rotate(90deg);
	flex-shrink: 0;
	margin-inline: -199px;
}

.why-choose__feature {
	display: flex;
	flex-direction: column;
	gap: 24px;
	padding-inline: 24px;
}

.why-choose__feature:last-child {
	padding-left: 36px;
}

.why-choose__feature-icon {
	width: 36px;
	height: 36px;
	color: var(--color-accent);
}

.why-choose__feature-title {
	font-family: var(--font-display);
	font-weight: 500;
	font-size: 18px;
	line-height: 1.3;
	text-transform: uppercase;
	color: white;
	margin: 0;
	text-wrap: balance;
    max-width: 200px;
}

.why-choose__feature-desc {
	font-family: var(--font-sans);
	font-weight: 400;
	font-size: 16px;
	line-height: 1.4;
	color: var(--color-text-gray);
	margin: 0;
}

.why-choose__feature-divider {
	height: 1px;
	background: rgba(255, 255, 255, 0.1);
	margin-inline: 24px;
}

@media (max-width: 1024px) {
	.why-choose__container {
		flex-direction: column;
	}
	
	.why-choose__content {
		flex: 1;
	}
	
	.why-choose__features {
		flex-direction: column;
		width: 100%;
	}
	
	.why-choose__col-divider {
		transform: rotate(0deg);
		width: 100%;
		height: 1px;
		margin: 0;
	}
}

@media (max-width: 768px) {
	.why-choose__title {
		font-size: 48px;
	}
	
	.why-choose__features {
		padding: 24px 16px;
	}
	
	.why-choose__feature {
		padding-inline: 16px;
	}
	
	.why-choose__feature:last-child {
		padding-left: 16px;
	}
}
</style>
